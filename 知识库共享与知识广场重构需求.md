# 知识库共享与知识广场重构 - 产品需求文档

## 📋 需求概述

将知识库从私有管理工具升级为**知识共享平台**，支持用户创建、分享和订阅优质知识库，构建学习型社区。

---

## 🎯 核心功能

### 1. 知识库分类体系

#### 1.1 分类标准
采用**中国学科门类分类**（13大类 + 其它）：

| 序号 | 分类 | 图标建议 | 说明 |
|-----|------|---------|------|
| 1 | 哲学 | 🧠 | 哲学理论、思想史等 |
| 2 | 经济学 | 💰 | 经济理论、金融、商业等 |
| 3 | 法学 | ⚖️ | 法律、法规、司法等 |
| 4 | 教育学 | 📚 | 教育理论、教学法等 |
| 5 | 文学 | 📖 | 文学作品、文学理论等 |
| 6 | 历史学 | 📜 | 历史事件、考古等 |
| 7 | 理学 | 🔬 | 数学、物理、化学等基础科学 |
| 8 | 工学 | ⚙️ | 工程技术、计算机等 |
| 9 | 农学 | 🌾 | 农业、林业、畜牧等 |
| 10 | 医学 | 🏥 | 医疗、健康、生物等 |
| 11 | 军事学 | 🎖️ | 军事理论、战略等 |
| 12 | 管理学 | 📊 | 管理理论、企业管理等 |
| 13 | 艺术学 | 🎨 | 艺术创作、艺术理论等 |
| 14 | 其它 | 📦 | 不属于以上分类的内容 |

#### 1.2 创建知识库时的变化

**Before（旧版）**：
```
知识库名称: [______]
知识库描述: [______]
添加标签: [技术] [学习] [AI] ... （多选）
```

**After（新版）**：
```
知识库名称: [______]
知识库描述: [______]
选择分类: [下拉选择] (单选，必选)
  └─ 哲学、经济学、法学、... 、其它
```

**优化建议**：
- ✅ **单选强制分类**：每个知识库必须选择一个主分类
- ✅ **保留标签功能**：建议保留标签作为二级分类（可选）
  - 例如：工学 > [人工智能] [机器学习] [深度学习]
  - 用于知识库内的精细化搜索和推荐

---

### 2. 知识库共享机制

#### 2.1 共享状态

```
┌─────────────────────────────────┐
│ 知识库状态                       │
├─────────────────────────────────┤
│ ○ 私有（默认）                   │
│   - 仅自己可见                    │
│   - 不出现在知识广场              │
│                                  │
│ ● 公开                           │
│   - 所有人可见                    │
│   - 出现在知识广场                │
│   - 他人可订阅                    │
└─────────────────────────────────┘
```

#### 2.2 共享入口设计

**位置**：知识库详情页 - 第二栏（KB Info Card）右上角

```
┌─────────────────────────────────────────┐
│ [头像]  我的知识库            [⚙️] [🗑️] [➕] │ ← 原有按钮
│         DeepSeek 系列论文    [🌐] ←────┘    │ ← 新增共享按钮
│                                             │
│         这是一个关于 DeepSeek 的知识库...   │
└─────────────────────────────────────────┘
```

**交互设计**：
```
点击 [🌐] 图标
  ↓
┌─────────────────────────────────┐
│ 知识库共享设置                   │
├─────────────────────────────────┤
│                                  │
│ 当前状态: ● 私有  ○ 公开         │
│                                  │
│ 公开后:                          │
│ • 所有用户可以查看此知识库       │
│ • 所有用户可以订阅此知识库       │
│ • 其他用户无法修改或删除内容     │
│ • 你可以随时关闭公开             │
│                                  │
│ [取消]            [确认公开]     │
└─────────────────────────────────┘
```

#### 2.3 权限控制

| 操作 | 所有者 | 订阅者 | 未订阅用户 |
|-----|-------|--------|-----------|
| 查看知识库信息 | ✅ | ✅ | ✅（仅公开） |
| 查看文档列表 | ✅ | ✅ | ✅（仅公开） |
| 预览文档内容 | ✅ | ✅ | ✅（仅公开） |
| 上传文档 | ✅ | ❌ | ❌ |
| 删除文档 | ✅ | ❌ | ❌ |
| 修改知识库信息 | ✅ | ❌ | ❌ |
| 删除知识库 | ✅ | ❌ | ❌ |
| 订阅知识库 | - | ✅（已订阅） | ✅ |
| 取消订阅 | - | ✅ | - |

**优化建议**：
- ✅ **订阅后的权限**：
  - 可以在"我的订阅"中快速访问
  - 可以收到知识库更新通知（可选）
  - 可以导出知识库内容（可选功能）

---

### 3. 知识广场重构

#### 3.1 页面布局

```
┌─────────────────────────────────────────────────────┐
│                     知识广场                          │
├─────────────────────────────────────────────────────┤
│                                                       │
│  [搜索框: 试试搜索感兴趣的知识库]                     │
│                                                       │
│  ┌─────┬─────┬─────┬─────┬─────┬────────┐           │
│  │2025精│哲学 │经济学│法学 │教育学│更多 ▼ │           │
│  │  选  │     │     │     │     │        │           │
│  └─────┴─────┴─────┴─────┴─────┴────────┘           │
│                                                       │
│  ┌────────────────────────────────────────┐          │
│  │ 📘 DeepSeek 系列论文          [订阅]   │          │
│  │    AI 技术的最新研究成果...             │          │
│  │    👤 1.2k 订阅  📄 45 文档  🔄 更新于2天前│       │
│  ├────────────────────────────────────────┤          │
│  │ 📙 机器学习入门               [订阅]   │          │
│  │    从零开始学习机器学习...              │          │
│  │    👤 856 订阅  📄 32 文档  🔄 更新于5天前 │       │
│  └────────────────────────────────────────┘          │
└─────────────────────────────────────────────────────┘
```

#### 3.2 分类设计

**一级分类（Tab）**：
```
┌────────────────────────────────────────────────┐
│ [2025精选] [哲学] [经济学] [法学] [教育学] [更多▼] │
└────────────────────────────────────────────────┘
```

**展开"更多"后**：
```
┌────────────────────────────────────────────────┐
│ [2025精选] [哲学] [经济学] [法学] [教育学] [更多▲] │
├────────────────────────────────────────────────┤
│ [文学] [历史学] [理学] [工学] [农学]            │
│ [医学] [军事学] [管理学] [艺术学] [其它]        │
└────────────────────────────────────────────────┘
```

**优化建议**：
- ✅ **默认展示5个热门分类**：
  1. 2025年度精选（固定）
  2. 工学（技术类最热门）
  3. 经济学（商业需求高）
  4. 管理学（职场需求高）
  5. 文学（通识需求高）
  - 其余折叠在"更多"中

- ✅ **智能排序**：
  - "更多"中的分类按**知识库数量**动态排序
  - 数量多的分类优先展示

#### 3.3 "2025年度精选"算法

**排序逻辑**：
```
排序分数 = (订阅数 × 0.4) + (文档数 × 0.2) + (更新活跃度 × 0.3) + (浏览量 × 0.1)

其中：
- 订阅数：知识库被订阅的总人数
- 文档数：知识库中的文档数量（上限50，避免灌水）
- 更新活跃度：最近30天的更新次数（上限10）
- 浏览量：最近7天的浏览次数
```

**展示规则**：
- 显示前 20-30 个知识库
- 每周更新一次榜单
- 标注"🔥 热门"、"📈 上升"等标签

**优化建议**：
- ✅ **多维度榜单**：
  - 🔥 本周最热
  - 📈 热度上升
  - ⭐ 订阅最多
  - 🆕 最新上线

---

### 4. 订阅功能

#### 4.1 订阅入口

**知识广场中**：
```
┌────────────────────────────────────┐
│ 📘 DeepSeek 系列论文    [➕ 订阅]  │
│    AI 技术的最新研究成果...         │
└────────────────────────────────────┘
```

**知识库详情页**：
```
┌─────────────────────────────────────┐
│ [头像]  DeepSeek 系列论文            │
│         by 张三                      │
│         [🌟 订阅此知识库]  [🌐 已公开] │
└─────────────────────────────────────┘
```

#### 4.2 订阅后的体验

**"我的订阅"入口**：
```
知识库页面第一栏：
┌─────────────────────┐
│ 我的知识库     [+]   │
│  📊 DeepSeek论文     │
│  📊 机器学习入门     │
│                      │
│ 我的订阅            │ ← 新增
│  📘 量子计算基础     │
│  📘 神经网络原理     │
└─────────────────────┘
```

**订阅状态**：
```
┌────────────────────────────────────┐
│ 📘 DeepSeek 系列论文    [✅ 已订阅] │
│    AI 技术的最新研究成果...         │
│    👤 1.2k 订阅  📄 45 文档          │
│    🔔 有 3 个新文档                 │ ← 更新提示
└────────────────────────────────────┘
```

#### 4.3 取消订阅

**入口**：
- 知识库详情页：[已订阅 ▼] → 取消订阅
- 我的订阅列表：右键菜单 → 取消订阅

**确认对话框**：
```
┌─────────────────────────────────┐
│ 取消订阅                         │
├─────────────────────────────────┤
│ 确定要取消订阅「DeepSeek系列论文」吗？│
│                                  │
│ 取消后:                          │
│ • 不再收到更新通知               │
│ • 不再显示在"我的订阅"中         │
│ • 仍可在知识广场中查看           │
│                                  │
│ [取消]            [确认取消订阅] │
└─────────────────────────────────┘
```

---

## 🗄️ 数据库设计

### 新增字段

#### 1. `knowledge_bases` 表
```sql
ALTER TABLE knowledge_bases 
ADD COLUMN category VARCHAR(50) NOT NULL DEFAULT '其它',
ADD COLUMN is_public BOOLEAN NOT NULL DEFAULT FALSE,
ADD COLUMN subscribers_count INTEGER NOT NULL DEFAULT 0,
ADD COLUMN view_count INTEGER NOT NULL DEFAULT 0,
ADD COLUMN last_updated_at TIMESTAMP;

-- 添加索引
CREATE INDEX idx_kb_category ON knowledge_bases(category);
CREATE INDEX idx_kb_public ON knowledge_bases(is_public);
CREATE INDEX idx_kb_subscribers ON knowledge_bases(subscribers_count DESC);
```

#### 2. 新建 `kb_subscriptions` 表
```sql
CREATE TABLE kb_subscriptions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    kb_id UUID NOT NULL REFERENCES knowledge_bases(id) ON DELETE CASCADE,
    subscribed_at TIMESTAMP NOT NULL DEFAULT NOW(),
    last_viewed_at TIMESTAMP,
    UNIQUE(user_id, kb_id)
);

CREATE INDEX idx_subscription_user ON kb_subscriptions(user_id);
CREATE INDEX idx_subscription_kb ON kb_subscriptions(kb_id);
```

#### 3. 新建 `kb_views` 表（可选，用于统计浏览量）
```sql
CREATE TABLE kb_views (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    kb_id UUID NOT NULL REFERENCES knowledge_bases(id) ON DELETE CASCADE,
    user_id UUID REFERENCES users(id) ON DELETE SET NULL,
    viewed_at TIMESTAMP NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_view_kb ON kb_views(kb_id, viewed_at);
CREATE INDEX idx_view_user ON kb_views(user_id);
```

---

## 🔌 API 设计

### 1. 知识库相关

#### 1.1 更新知识库（新增分类和公开状态）
```
PATCH /api/kb/{kbId}
Body: {
  "name": "...",
  "description": "...",
  "category": "工学",        // 新增
  "is_public": true          // 新增
}
```

#### 1.2 切换公开状态
```
POST /api/kb/{kbId}/toggle-public
Response: {
  "is_public": true,
  "subscribers_count": 0
}
```

### 2. 订阅相关

#### 2.1 订阅知识库
```
POST /api/kb/{kbId}/subscribe
Response: {
  "success": true,
  "subscribers_count": 1234
}
```

#### 2.2 取消订阅
```
DELETE /api/kb/{kbId}/subscribe
Response: {
  "success": true,
  "subscribers_count": 1233
}
```

#### 2.3 获取我的订阅列表
```
GET /api/kb/subscriptions?page=1&pageSize=20
Response: {
  "total": 5,
  "items": [...]
}
```

#### 2.4 检查订阅状态
```
GET /api/kb/{kbId}/subscription-status
Response: {
  "is_subscribed": true,
  "subscribed_at": "2025-01-15T10:30:00Z"
}
```

### 3. 知识广场相关

#### 3.1 获取公开知识库列表（按分类）
```
GET /api/kb/public?category=工学&page=1&pageSize=20
Response: {
  "total": 156,
  "items": [...]
}
```

#### 3.2 获取年度精选
```
GET /api/kb/featured?year=2025&page=1&pageSize=20
Response: {
  "total": 30,
  "items": [...]
}
```

#### 3.3 获取分类统计
```
GET /api/kb/categories-stats
Response: {
  "categories": [
    { "category": "工学", "count": 156, "subscribers": 5234 },
    { "category": "经济学", "count": 89, "subscribers": 3456 },
    ...
  ]
}
```

---

## 🎨 UI/UX 优化建议

### 1. 视觉设计

#### 1.1 知识库卡片
```
┌────────────────────────────────────────┐
│ [📘]  DeepSeek 系列论文     [工学]      │ ← 分类标签
│       by 张三                [➕订阅]   │
│                                         │
│ AI 技术的最新研究成果，包含 DeepSeek-V2、│
│ DeepSeek-Coder 等论文...                │
│                                         │
│ 👤 1.2k 订阅  📄 45 文档  🔄 2天前更新  │
└────────────────────────────────────────┘
```

#### 1.2 分类配色方案
```
哲学   → 🧠 深紫色  #6B46C1
经济学 → 💰 金色    #F59E0B
法学   → ⚖️ 深蓝色  #1E40AF
教育学 → 📚 绿色    #10B981
文学   → 📖 粉红色  #EC4899
历史学 → 📜 棕色    #92400E
理学   → 🔬 青色    #06B6D4
工学   → ⚙️ 蓝色    #3B82F6
农学   → 🌾 草绿色  #84CC16
医学   → 🏥 红色    #EF4444
军事学 → 🎖️ 橄榄绿  #65A30D
管理学 → 📊 紫色    #8B5CF6
艺术学 → 🎨 橙色    #F97316
其它   → 📦 灰色    #6B7280
```

### 2. 交互优化

#### 2.1 共享确认流程
```
点击共享按钮
  ↓
显示共享说明（第一次）
  ↓
确认公开
  ↓
显示成功提示："知识库已公开，现在所有人都可以看到它了！"
  ↓
自动跳转到知识广场中的该知识库
```

#### 2.2 订阅动画
- 点击"订阅"按钮 → 按钮变为"已订阅"，显示 ✓ 动画
- 订阅数 +1，数字跳动动画
- Toast 提示："已订阅「DeepSeek系列论文」"

### 3. 搜索增强

#### 3.1 智能搜索
```
支持搜索：
- 知识库名称
- 知识库描述
- 创建者名称
- 分类名称
- 标签（如果保留）
```

#### 3.2 搜索建议
```
搜索框下方显示：
┌─────────────────────────┐
│ 🔥 热门搜索:              │
│   机器学习  深度学习  AI  │
│   经济学  管理学  文学    │
└─────────────────────────┘
```

---

## 📊 数据统计与分析

### 1. 知识库所有者看板

```
┌─────────────────────────────────────┐
│ 我的知识库 - DeepSeek系列论文        │
├─────────────────────────────────────┤
│ 📊 数据统计（最近30天）              │
│                                      │
│  👁️  浏览量        1,234           │
│  👤  订阅数        89               │
│  📄  文档数        45               │
│  🔄  更新次数      12               │
│                                      │
│ 📈 趋势图                            │
│  [订阅数增长曲线]                    │
└─────────────────────────────────────┘
```

### 2. 全局统计（管理员）

```
- 总知识库数
- 公开知识库数
- 总订阅数
- 各分类知识库分布
- 最活跃的创作者
```

---

## 🚀 实现优先级

### Phase 1（核心功能，2周）
- ✅ 数据库结构调整
- ✅ 知识库分类选择
- ✅ 公开/私有切换
- ✅ 知识广场基础展示
- ✅ 订阅/取消订阅

### Phase 2（增强功能，1周）
- ✅ 分类统计与排序
- ✅ 2025年度精选算法
- ✅ 我的订阅列表
- ✅ 权限控制优化

### Phase 3（体验优化，1周）
- ✅ 搜索增强
- ✅ 数据统计看板
- ✅ 更新通知
- ✅ UI/UX 打磨

---

## ⚠️ 风险与注意事项

### 1. 内容审核
- **问题**：公开知识库可能包含不当内容
- **方案**：
  - 初期人工审核（知识库公开后进入审核队列）
  - 中期关键词过滤
  - 长期 AI 内容审核

### 2. 存储成本
- **问题**：公开知识库可能导致存储占用激增
- **方案**：
  - 限制单个知识库大小（如 1GB）
  - 限制文档数量（如 100个）
  - 付费用户更高配额

### 3. 版权问题
- **问题**：用户上传的文档可能侵权
- **方案**：
  - 用户协议声明（上传即表示拥有版权）
  - 举报机制
  - DMCA 快速下架流程

### 4. 恶意刷量
- **问题**：恶意刷订阅数、浏览量
- **方案**：
  - IP 限流
  - 用户行为分析（异常订阅检测）
  - 验证码机制

---

## 🎯 成功指标

### 1. 数量指标
- 公开知识库数 > 100
- 总订阅数 > 1000
- DAU（日活跃用户） > 500

### 2. 质量指标
- 平均订阅数 > 10
- 知识库更新频率 > 1次/周
- 用户留存率 > 60%

### 3. 社区指标
- 知识库创建者数 > 50
- 跨领域知识库 > 10个分类
- 用户互动（评论、点赞）> 100次/天

---

## 📝 总结

这次重构将 Reader 从**个人知识管理工具**升级为**知识共享平台**，核心变化：

1. **知识库分类体系**：采用学科分类，便于发现和组织
2. **公开/私有机制**：用户自主选择是否分享
3. **知识广场**：集中展示优质内容
4. **订阅系统**：连接创作者和学习者
5. **权限控制**：保护所有者权益

这是一个**从工具到平台**的转变，为构建学习型社区奠定基础。🚀

