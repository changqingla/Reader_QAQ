# 知识库页面样式统一说明

## 📝 问题描述

用户发现从 `/knowledge` 页面点击某个知识库进入 `/knowledge/:kbId` 详情页面时，第一栏（知识库列表侧边栏）的样式没有同步更新，仍然使用旧的设计。

## ✅ 解决方案

将 `Knowledge.tsx` 中优化的第一栏代码和样式完全同步到 `KnowledgeDetail.tsx`，确保两个页面的侧边栏保持一致。

## 🔄 同步的内容

### 1. **功能代码同步**

#### 新增状态管理
```typescript
const [editingKb, setEditingKb] = useState<string | null>(null);
const [newKbName, setNewKbName] = useState('');
const [kbMenuOpen, setKbMenuOpen] = useState<string | null>(null);
```

#### 新增处理函数
- `handleRenameKb()` - 重命名知识库
- `handleKbNameSubmit()` - 提交知识库名称
- `handleDeleteKbFromSidebar()` - 从侧边栏删除知识库
  - 特别处理：如果删除的是当前查看的知识库，自动跳转回 `/knowledge` 列表页

### 2. **JSX 结构同步**

#### 旧代码（已删除）
```jsx
<div className={styles.storageRow}>
  <span>我的知识库</span>
  <button className={styles.addKbBtn}>
    <Plus size={14} />
  </button>
</div>
<div className={styles.myList}>
  {myKnowledgeBases.map((kb) => (
    <button className={styles.myItem}>
      <span className={styles.myDot} />
      {kb.name}
    </button>
  ))}
</div>
<div className={styles.sectionCollapse}>
  {/* 订阅部分 */}
</div>
```

#### 新代码（已同步）
```jsx
<div className={styles.kbHeader}>
  <h2 className={styles.kbTitle}>我的知识库</h2>
  <button className={styles.addKbBtn}>
    <Plus size={16} />
  </button>
</div>
<div className={styles.kbList}>
  {myKnowledgeBases.map((kb) => (
    editingKb === kb.id ? (
      <div className={styles.kbItemEdit}>
        <Database size={16} />
        <input className={styles.kbInput} ... />
      </div>
    ) : (
      <div className={styles.kbItemWrapper}>
        <button className={styles.kbItem}>
          <Database size={16} />
          <span>{kb.name}</span>
        </button>
        <div className={styles.kbActions}>
          <button className={styles.kbMenuBtn}>
            <MoreVertical size={14} />
          </button>
          {kbMenuOpen === kb.id && (
            <div className={styles.kbMenu}>
              <button>重命名</button>
              <button>删除</button>
            </div>
          )}
        </div>
      </div>
    )
  ))}
</div>
```

### 3. **CSS 样式同步**

#### 删除的旧样式类
- `.storageRow`
- `.myList`
- `.myItem`
- `.myItemActive` (旧版本)
- `.myDot`
- `.sectionCollapse`
- `.collapseBtnSm`
- `.subscribeList`
- `.subItem`

#### 新增的样式类
- `.kbHeader` - 标题栏容器
- `.kbTitle` - 标题文字（16px 粗体）
- `.kbList` - 知识库列表容器
- `.kbItemWrapper` - 知识库项包装器
- `.kbItem` - 知识库项按钮
- `.kbItemActive` - 激活状态（新版本）
- `.kbItemEdit` - 编辑模式容器
- `.kbInput` - 编辑输入框
- `.kbActions` - 操作按钮容器
- `.kbMenuBtn` - 菜单按钮
- `.kbMenu` - 下拉菜单
- `.kbMenuItem` - 菜单项

### 4. **图标更新**
- 旧：小圆点 (`.myDot`)
- 新：`Database` 图标
- 新增：`Edit3` 图标（重命名）

## 📁 修改的文件

```
web/pages/KnowledgeDetail.tsx           # 功能实现
web/pages/KnowledgeDetail.module.css    # 样式同步
```

## 🎯 实现效果

### Knowledge 页面 (`/knowledge`)
```
我的知识库                    [+]
  📊 我的知识库              [⋮]
  📊 DeepSeek系列论文         [⋮]
  📊 技术文档                [⋮]
```

### KnowledgeDetail 页面 (`/knowledge/:kbId`)
```
我的知识库                    [+]
  📊 我的知识库              [⋮]  ← 当前查看（高亮）
  📊 DeepSeek系列论文         [⋮]
  📊 技术文档                [⋮]
```

**完全一致的侧边栏设计！**

## 🔑 关键特性

### 1. **样式一致性**
- 两个页面的第一栏完全相同
- 字体大小、颜色、间距完全一致
- 交互效果（hover、active）完全一致

### 2. **功能一致性**
- 都支持重命名知识库
- 都支持删除知识库
- 都支持创建新知识库
- 都使用相同的图标

### 3. **交互优化**
- **当前知识库高亮**：在详情页中，当前查看的知识库会高亮显示
- **快速切换**：可以直接在详情页切换到其他知识库
- **智能跳转**：删除当前查看的知识库时，自动跳转回列表页

### 4. **代码一致性**
- 使用相同的 CSS 类名
- 使用相同的状态管理逻辑
- 使用相同的事件处理函数

## 🧪 测试场景

### 测试 1：侧边栏样式一致性
1. 访问 `/knowledge` 页面
2. 点击某个知识库进入详情页
3. **验证**：第一栏样式完全相同（字体、图标、布局）

### 测试 2：重命名功能
1. 在详情页的侧边栏中找到任意知识库
2. 鼠标悬停，点击三个点菜单
3. 点击"重命名"，修改名称后按 Enter
4. **验证**：名称更新，页面标题同步更新（如果是当前知识库）

### 测试 3：删除功能
1. 在详情页的侧边栏中找到任意知识库
2. 点击三个点菜单 → 删除
3. 确认删除
4. **验证**：知识库被删除

### 测试 4：删除当前知识库
1. 在详情页中，删除**当前正在查看**的知识库
2. **验证**：自动跳转回 `/knowledge` 列表页

### 测试 5：快速切换
1. 在详情页 A 中
2. 点击侧边栏的知识库 B
3. **验证**：页面切换到知识库 B 的详情页，侧边栏保持一致

## 📊 对比总结

| 特性 | 旧版本 | 新版本 |
|-----|-------|-------|
| 标题样式 | 小字体 (12px) | 大字体 (16px) |
| 知识库图标 | 小圆点 | Database 图标 |
| 订阅部分 | 显示 | 已移除 |
| 重命名功能 | ❌ | ✅ |
| 删除功能 | ❌ | ✅ |
| 当前项高亮 | ❌ | ✅ |
| 样式一致性 | Knowledge ≠ KnowledgeDetail | Knowledge = KnowledgeDetail |

## 🎉 优化成果

### ✅ 解决了什么问题
1. **样式不一致**：两个页面的侧边栏现在完全相同
2. **功能缺失**：详情页侧边栏现在也支持重命名和删除
3. **导航体验差**：现在可以在详情页快速切换知识库
4. **代码冗余**：删除了旧的不再使用的样式和代码

### ✅ 带来的好处
1. **用户体验更好**：页面跳转时侧边栏不变，降低认知负担
2. **交互更流畅**：详情页也能管理知识库，无需返回列表页
3. **代码更规范**：两个页面共享相同的设计和逻辑
4. **维护更简单**：未来只需修改一处，两个页面同步更新

## 🔍 注意事项

1. **状态同步**：重命名后会自动刷新知识库列表
2. **路由跳转**：删除当前知识库会自动跳转
3. **样式继承**：两个页面都引用相同的 CSS 类
4. **事件冒泡**：菜单按钮使用 `stopPropagation` 防止触发知识库点击

## 📝 代码规范

遵循用户的项目规则：
- ✅ 删除不再使用的代码（旧样式类）
- ✅ 避免代码冗余
- ✅ 遵循软件工程开发规范
- ✅ 保持两个页面的一致性

