# å…¬ç½‘è®¿é—®é…ç½®æŒ‡å—

## ðŸ“Œ å½“å‰æ˜ å°„å…³ç³»

- **å‰ç«¯**ï¼š`http://10.0.169.144:3003` â†’ `http://39.183.168.206:30003` âœ…
- **åŽç«¯**ï¼š`http://10.0.169.144:8000` â†’ `http://39.183.168.206:????`ï¼ˆè¯·ç¡®è®¤åŽç«¯å…¬ç½‘ç«¯å£ï¼‰
- **MinIO**ï¼š`http://10.0.169.144:8999` â†’ `http://39.183.168.206:????`ï¼ˆè¯·ç¡®è®¤ MinIO å…¬ç½‘ç«¯å£ï¼‰

## âš™ï¸ é…ç½®æ­¥éª¤

### 1. å‰ç«¯é…ç½®

#### æ­¥éª¤ 1ï¼šåˆ›å»ºçŽ¯å¢ƒå˜é‡æ–‡ä»¶

åœ¨ `/data/ht/workspace/Reader_QAQ/web/` ç›®å½•ä¸‹åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cd /data/ht/workspace/Reader_QAQ/web
cat > .env << 'EOF'
# åŽç«¯ API å…¬ç½‘åœ°å€ï¼ˆè¯·æ ¹æ®å®žé™…åŽç«¯å…¬ç½‘ç«¯å£ä¿®æ”¹ï¼‰
VITE_API_URL=http://39.183.168.206:30000/api
EOF
```

**âš ï¸ é‡è¦**ï¼šè¯·å°† `30000` æ”¹ä¸ºæ‚¨å®žé™…çš„åŽç«¯å…¬ç½‘ç«¯å£ï¼

#### æ­¥éª¤ 2ï¼šé‡æ–°æž„å»ºå‰ç«¯

```bash
cd /data/ht/workspace/Reader_QAQ/web
npm run build
```

å¦‚æžœä½¿ç”¨å¼€å‘æ¨¡å¼ï¼š
```bash
npm run dev
```

### 2. åŽç«¯é…ç½®

#### æ­¥éª¤ 1ï¼šåŽç«¯ CORS é…ç½®ï¼ˆå·²å®Œæˆ âœ…ï¼‰
åŽç«¯ CORS é…ç½®å·²æ›´æ–°ï¼Œå…è®¸ä»¥ä¸‹æ¥æºè®¿é—®ï¼š
- `http://localhost:3003` - æœ¬åœ°å¼€å‘
- `http://10.0.169.144:3003` - å†…ç½‘åœ°å€
- `http://39.183.168.206:30003` - å…¬ç½‘å‰ç«¯åœ°å€
- `*` - æ‰€æœ‰æ¥æºï¼ˆä¸´æ—¶ï¼Œç”Ÿäº§çŽ¯å¢ƒå»ºè®®ç§»é™¤ï¼‰

#### æ­¥éª¤ 2ï¼šMinIO å…¬ç½‘åœ°å€é…ç½® âš ï¸

**é‡è¦**ï¼šMinIO é…ç½®å·²æ·»åŠ ä½†éœ€è¦æ‚¨ä¿®æ”¹ä¸ºå®žé™…ç«¯å£ï¼

æ‰“å¼€ `/data/ht/workspace/Reader_QAQ/src/config/settings.py`ï¼Œä¿®æ”¹ï¼š

```python
MINIO_PUBLIC_ENDPOINT: str = "39.183.168.206:30999"  # âš ï¸ æ”¹ä¸ºå®žé™… MinIO å…¬ç½‘ç«¯å£
```

**æˆ–è€…**ç›´æŽ¥æ‰§è¡Œå‘½ä»¤ï¼ˆæ›¿æ¢ `30999` ä¸ºå®žé™…ç«¯å£ï¼‰ï¼š

```bash
# ç¤ºä¾‹ï¼šå¦‚æžœ MinIO å…¬ç½‘ç«¯å£æ˜¯ 30999
sed -i 's/MINIO_PUBLIC_ENDPOINT: str = "39.183.168.206:30999"/MINIO_PUBLIC_ENDPOINT: str = "39.183.168.206:30999"/' /data/ht/workspace/Reader_QAQ/src/config/settings.py
```

#### æ­¥éª¤ 3ï¼šé‡å¯åŽç«¯æœåŠ¡

```bash
cd /data/ht/workspace/Reader_QAQ/src
python main.py
```

### 3. éªŒè¯é…ç½®

#### æ–¹æ³• 1ï¼šé€šè¿‡æµè§ˆå™¨è®¿é—®

1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š`http://39.183.168.206:30003`
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰â†’ Network æ ‡ç­¾
3. å°è¯•ç™»å½•æˆ–æ³¨å†Œ
4. æŸ¥çœ‹è¯·æ±‚æ˜¯å¦æˆåŠŸå‘é€åˆ°åŽç«¯

#### æ–¹æ³• 2ï¼šæµ‹è¯•åŽç«¯ API

```bash
# æµ‹è¯•åŽç«¯å¥åº·æ£€æŸ¥ï¼ˆæ›¿æ¢ä¸ºå®žé™…åŽç«¯å…¬ç½‘ç«¯å£ï¼‰
curl http://39.183.168.206:30000/api/health
```

åº”è¯¥è¿”å›žï¼š
```json
{"status": "ok"}
```

## ðŸ” å¸¸è§é—®é¢˜æŽ’æŸ¥

### é—®é¢˜ 0ï¼šå¤´åƒæˆ–æ–‡æ¡£æ— æ³•åŠ è½½

**çŽ°è±¡**ï¼šä¸Šä¼ çš„çŸ¥è¯†åº“å¤´åƒæˆ–æ–‡æ¡£æ˜¾ç¤ºä¸å‡ºæ¥

**åŽŸå› **ï¼šMinIO å…¬ç½‘åœ°å€æœªé…ç½®æˆ–é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ MinIO å·²æ˜ å°„åˆ°å…¬ç½‘ç«¯å£
2. åœ¨ `src/config/settings.py` ä¸­æ­£ç¡®é…ç½® `MINIO_PUBLIC_ENDPOINT`
3. é‡å¯åŽç«¯æœåŠ¡

**éªŒè¯ MinIO æ˜¯å¦å¯è®¿é—®**ï¼š
```bash
# æ›¿æ¢ä¸ºå®žé™… MinIO å…¬ç½‘ç«¯å£
curl http://39.183.168.206:30999
```

### é—®é¢˜ 1ï¼šå‰ç«¯è¯·æ±‚å¤±è´¥ï¼ˆCORS é”™è¯¯ï¼‰

**çŽ°è±¡**ï¼šæµè§ˆå™¨æŽ§åˆ¶å°æ˜¾ç¤º CORS é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤åŽç«¯å·²é‡å¯
2. æ£€æŸ¥ `src/config/settings.py` ä¸­çš„ `CORS_ORIGINS` æ˜¯å¦åŒ…å«å‰ç«¯å…¬ç½‘åœ°å€
3. å¦‚æžœé—®é¢˜ä¾ç„¶å­˜åœ¨ï¼Œä¸´æ—¶ä½¿ç”¨ `"*"` å…è®¸æ‰€æœ‰æ¥æº

### é—®é¢˜ 2ï¼šAPI è¯·æ±‚ 404

**çŽ°è±¡**ï¼šæ‰€æœ‰ API è¯·æ±‚è¿”å›ž 404

**åŽŸå› **ï¼šå‰ç«¯ `.env` æ–‡ä»¶ä¸­çš„ API åœ°å€ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤åŽç«¯å…¬ç½‘ç«¯å£å·
2. æ›´æ–° `web/.env` æ–‡ä»¶ä¸­çš„ `VITE_API_URL`
3. é‡æ–°æž„å»ºå‰ç«¯ï¼š`npm run build`

### é—®é¢˜ 3ï¼šæ— æ³•è®¿é—®å…¬ç½‘åœ°å€

**å¯èƒ½åŽŸå› **ï¼š
1. é˜²ç«å¢™æœªå¼€æ”¾ç«¯å£
2. äº‘æœåŠ¡å™¨å®‰å…¨ç»„æœªé…ç½®
3. ç«¯å£æ˜ å°„æœªç”Ÿæ•ˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
netstat -tlnp | grep 3003
netstat -tlnp | grep 8000

# å¦‚æžœä½¿ç”¨ firewalld
sudo firewall-cmd --add-port=30003/tcp --permanent
sudo firewall-cmd --add-port=30000/tcp --permanent
sudo firewall-cmd --reload

# å¦‚æžœä½¿ç”¨ ufw
sudo ufw allow 30003/tcp
sudo ufw allow 30000/tcp
```

## ðŸ“ é…ç½®æ–‡ä»¶æ€»ç»“

### å‰ç«¯ `.env` æ–‡ä»¶ä½ç½®

```
/data/ht/workspace/Reader_QAQ/web/.env
```

å†…å®¹ç¤ºä¾‹ï¼š
```env
VITE_API_URL=http://39.183.168.206:30000/api
```

### åŽç«¯ CORS é…ç½®ä½ç½®

```
/data/ht/workspace/Reader_QAQ/src/config/settings.py
```

å·²é…ç½®ä¸ºå…è®¸å…¬ç½‘è®¿é—® âœ…

## ðŸš€ å¿«é€Ÿé…ç½®å‘½ä»¤

```bash
# 1. åˆ›å»ºå‰ç«¯ .env æ–‡ä»¶ï¼ˆè¯·å…ˆç¡®è®¤åŽç«¯å…¬ç½‘ç«¯å£ï¼‰
cat > /data/ht/workspace/Reader_QAQ/web/.env << 'EOF'
VITE_API_URL=http://39.183.168.206:30000/api
EOF

# 2. é‡å¯åŽç«¯
cd /data/ht/workspace/Reader_QAQ/src
python main.py

# 3. é‡å¯å‰ç«¯ï¼ˆå¼€å‘æ¨¡å¼ï¼‰
cd /data/ht/workspace/Reader_QAQ/web
npm run dev

# æˆ–æž„å»ºç”Ÿäº§ç‰ˆæœ¬
cd /data/ht/workspace/Reader_QAQ/web
npm run build
```

## ðŸ“Œ æ³¨æ„äº‹é¡¹

1. **åŽç«¯å…¬ç½‘ç«¯å£**ï¼šè¯·ç¡®è®¤æ‚¨çš„åŽç«¯æœåŠ¡æ˜ å°„åˆ°äº†å“ªä¸ªå…¬ç½‘ç«¯å£ï¼Œå¹¶ç›¸åº”æ›´æ–° `.env` æ–‡ä»¶

2. **ç”Ÿäº§çŽ¯å¢ƒ CORS**ï¼šå½“å‰é…ç½®åŒ…å« `"*"`ï¼Œè¿™åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸å®‰å…¨ã€‚é…ç½®å®ŒæˆåŽï¼Œå»ºè®®ä»Ž `CORS_ORIGINS` ä¸­ç§»é™¤ `"*"`ï¼Œåªä¿ç•™å…·ä½“çš„åŸŸå

3. **HTTPS**ï¼šå¦‚æžœä½¿ç”¨ HTTPSï¼Œéœ€è¦ï¼š
   - æ›´æ–° `.env` ä¸­çš„ URL ä¸º `https://`
   - é…ç½® SSL è¯ä¹¦
   - æ›´æ–° CORS é…ç½®

4. **çŽ¯å¢ƒå˜é‡ä¼˜å…ˆçº§**ï¼š
   - `.env.production` - ç”Ÿäº§çŽ¯å¢ƒï¼ˆ`npm run build`ï¼‰
   - `.env.development` - å¼€å‘çŽ¯å¢ƒï¼ˆ`npm run dev`ï¼‰
   - `.env` - é»˜è®¤é…ç½®

## ðŸŽ¯ é…ç½®æ¸…å•

è¯·ç¡®è®¤ä»¥ä¸‹æ˜ å°„å…³ç³»å¹¶å®Œæˆé…ç½®ï¼š

| æœåŠ¡ | å†…ç½‘åœ°å€ | å…¬ç½‘ç«¯å£ | é…ç½®æ–‡ä»¶ | é…ç½®é¡¹ | çŠ¶æ€ |
|------|---------|---------|---------|--------|------|
| å‰ç«¯ | 10.0.169.144:3003 | 30003 | `web/.env` | `VITE_API_URL` | âš ï¸ å¾…é…ç½® |
| åŽç«¯ | 10.0.169.144:8000 | ??? | - | CORS å·²é…ç½® | âœ… å·²å®Œæˆ |
| MinIO | 10.0.169.144:8999 | ??? | `src/config/settings.py` | `MINIO_PUBLIC_ENDPOINT` | âš ï¸ å¾…ç¡®è®¤ |

## â“ ä¸‹ä¸€æ­¥

è¯·å‘Šè¯‰æˆ‘ï¼š
1. **åŽç«¯å…¬ç½‘ç«¯å£å·**ï¼ˆä¾‹å¦‚ï¼š30000ï¼‰
2. **MinIO å…¬ç½‘ç«¯å£å·**ï¼ˆä¾‹å¦‚ï¼š30999ï¼‰

æˆ‘å¯ä»¥å¸®æ‚¨ç”Ÿæˆå®Œæ•´çš„é…ç½®å‘½ä»¤ï¼

ç¤ºä¾‹å›žç­”ï¼š
- "åŽç«¯æ˜¯ 30000ï¼ŒMinIO æ˜¯ 30999"
- "åŽç«¯æ˜¯ 8000ï¼ŒMinIO æ˜¯ 8999"

