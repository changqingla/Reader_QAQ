# å¼€å‘/ç”Ÿäº§ç¯å¢ƒåˆ‡æ¢è¯´æ˜

## ğŸ¯ MinIO é…ç½®å·®å¼‚

### å¼€å‘ç¯å¢ƒ
- å‰ç«¯ç›´æ¥è®¿é—® MinIO å†…ç½‘åœ°å€ï¼š`http://10.0.169.144:8999`
- åç«¯è¿”å›å®Œæ•´çš„ presigned URLï¼ˆåŒ…å«ç­¾åï¼‰
- ä¸é€šè¿‡ä»£ç†

### ç”Ÿäº§ç¯å¢ƒ
- å‰ç«¯é€šè¿‡ Nginx ä»£ç†è®¿é—®ï¼š`/minio/*`
- åç«¯è¿”å›ç›¸å¯¹è·¯å¾„
- ç»Ÿä¸€é€šè¿‡å…¬ç½‘ç«¯å£è®¿é—®

## ğŸ”„ åˆ‡æ¢æ­¥éª¤

### åˆ‡æ¢åˆ°å¼€å‘ç¯å¢ƒ

**1. ä¿®æ”¹åç«¯é…ç½®** (`src/config/settings.py`)
```python
MINIO_PUBLIC_ENDPOINT: str = "10.0.169.144:8999"
```

**2. é‡å¯åç«¯**
```bash
cd /data/ht/workspace/Reader_QAQ/src
# åœæ­¢å½“å‰åç«¯ï¼ˆCtrl+Cï¼‰
python main.py
```

**3. é‡å¯å‰ç«¯**
```bash
cd /data/ht/workspace/Reader_QAQ/web
# åœæ­¢å½“å‰å‰ç«¯ï¼ˆCtrl+Cï¼‰
# æ¸…ç†ç¼“å­˜
rm -rf node_modules/.vite
# é‡æ–°å¯åŠ¨
npm run dev
```

**4. åªå¯åŠ¨åŸºç¡€ Docker æœåŠ¡**
```bash
cd /data/ht/workspace/Reader_QAQ/docker
docker-compose up -d reader_postgres reader_redis reader_minio
# ä¸å¯åŠ¨ Nginx
```

---

### åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒ

**1. ä¿®æ”¹åç«¯é…ç½®** (`src/config/settings.py`)
```python
MINIO_PUBLIC_ENDPOINT: str = "nginx"
```

**2. æ„å»ºå‰ç«¯**
```bash
cd /data/ht/workspace/Reader_QAQ/web
npm run build
```

**3. å¯åŠ¨æ‰€æœ‰ Docker æœåŠ¡**
```bash
cd /data/ht/workspace/Reader_QAQ/docker
docker-compose up -d
# åŒ…æ‹¬ Nginx
```

**4. é‡å¯åç«¯**
```bash
cd /data/ht/workspace/Reader_QAQ/src
# åœæ­¢å½“å‰åç«¯ï¼ˆCtrl+Cï¼‰
python main.py
```

**5. è®¿é—®**
- å…¬ç½‘ï¼š`http://39.183.168.206:30003`

---

## ğŸ“‹ å¿«é€Ÿå‚è€ƒ

| é…ç½®é¡¹ | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|--------|---------|---------|
| `MINIO_PUBLIC_ENDPOINT` | `10.0.169.144:8999` | `nginx` |
| å‰ç«¯è®¿é—®æ–¹å¼ | å¼€å‘æœåŠ¡å™¨ (3003) | Nginx é™æ€æ–‡ä»¶ |
| MinIO è®¿é—® | ç›´æ¥è®¿é—®å†…ç½‘ | é€šè¿‡ Nginx ä»£ç† |
| Docker æœåŠ¡ | åªå¯åŠ¨ PG/Redis/MinIO | å¯åŠ¨å…¨éƒ¨ï¼ˆå« Nginxï¼‰ |
| å‰ç«¯å¯åŠ¨å‘½ä»¤ | `npm run dev` | ä¸éœ€è¦ï¼ˆå·²æ„å»ºï¼‰ |

---

## ğŸ” éªŒè¯é…ç½®

### å¼€å‘ç¯å¢ƒéªŒè¯
```bash
# 1. æ£€æŸ¥åç«¯é…ç½®
grep "MINIO_PUBLIC_ENDPOINT" src/config/settings.py
# åº”è¯¥æ˜¾ç¤º: MINIO_PUBLIC_ENDPOINT: str = "10.0.169.144:8999"

# 2. æ£€æŸ¥ Docker æœåŠ¡ï¼ˆä¸åº”æœ‰ Nginxï¼‰
docker ps --format "table {{.Names}}\t{{.Status}}"
# åº”è¯¥åªæœ‰ reader_postgres, reader_redis, reader_minio

# 3. æµ‹è¯•å¤´åƒä¸Šä¼ 
# ä¸Šä¼ åæ£€æŸ¥æµè§ˆå™¨ Networkï¼ŒURL åº”è¯¥æ˜¯ï¼š
# http://10.0.169.144:8999/reader-uploads/kb_avatars/...
```

### ç”Ÿäº§ç¯å¢ƒéªŒè¯
```bash
# 1. æ£€æŸ¥åç«¯é…ç½®
grep "MINIO_PUBLIC_ENDPOINT" src/config/settings.py
# åº”è¯¥æ˜¾ç¤º: MINIO_PUBLIC_ENDPOINT: str = "nginx"

# 2. æ£€æŸ¥ Docker æœåŠ¡ï¼ˆåº”æœ‰ Nginxï¼‰
docker ps --format "table {{.Names}}\t{{.Status}}"
# åº”è¯¥æœ‰ reader_nginx

# 3. æ£€æŸ¥å‰ç«¯æ„å»º
ls -lh web/dist/index.html
# æ–‡ä»¶åº”è¯¥å­˜åœ¨

# 4. æµ‹è¯•å¤´åƒä¸Šä¼ 
# ä¸Šä¼ åæ£€æŸ¥æµè§ˆå™¨ Networkï¼ŒURL åº”è¯¥æ˜¯ï¼š
# /minio/reader-uploads/kb_avatars/...
```

---

## âš ï¸ å¸¸è§é”™è¯¯

### é”™è¯¯ 1: MinIO 403 Forbidden

**åŸå› **ï¼šç¯å¢ƒé…ç½®ä¸åŒ¹é…

**è§£å†³**ï¼š
- å¼€å‘ç¯å¢ƒï¼šç¡®ä¿ `MINIO_PUBLIC_ENDPOINT = "10.0.169.144:8999"`
- ç”Ÿäº§ç¯å¢ƒï¼šç¡®ä¿ `MINIO_PUBLIC_ENDPOINT = "nginx"`
- è®°å¾—é‡å¯åç«¯ï¼

### é”™è¯¯ 2: å‰ç«¯è¯·æ±‚ CORS é”™è¯¯

**åŸå› **ï¼šVite ä»£ç†æœªç”Ÿæ•ˆæˆ–é…ç½®é”™è¯¯

**è§£å†³**ï¼š
```bash
# æ¸…ç†ç¼“å­˜å¹¶é‡å¯
cd web
rm -rf node_modules/.vite
npm run dev
```

### é”™è¯¯ 3: Nginx 404

**åŸå› **ï¼šå‰ç«¯æœªæ„å»ºæˆ– Nginx æœªå¯åŠ¨

**è§£å†³**ï¼š
```bash
# æ„å»ºå‰ç«¯
cd web
npm run build

# å¯åŠ¨ Nginx
cd docker
docker-compose up -d reader_nginx
```

---

## ğŸ’¡ æç¤º

**æ¨èä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†é…ç½®**

å¯ä»¥åˆ›å»ºä¸åŒçš„é…ç½®æ–‡ä»¶ï¼š
- `config/settings_dev.py` - å¼€å‘ç¯å¢ƒ
- `config/settings_prod.py` - ç”Ÿäº§ç¯å¢ƒ

ç„¶åé€šè¿‡ç¯å¢ƒå˜é‡åˆ‡æ¢ï¼š
```bash
export ENV=development  # æˆ– production
```

---

## âœ… å½“å‰é…ç½®

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰ç¯å¢ƒï¼š

```bash
# æŸ¥çœ‹ MinIO é…ç½®
grep "MINIO_PUBLIC_ENDPOINT" src/config/settings.py

# æŸ¥çœ‹è¿è¡Œçš„æœåŠ¡
docker ps

# åˆ¤æ–­ç¯å¢ƒ
if docker ps | grep -q reader_nginx; then
    echo "å½“å‰æ˜¯ç”Ÿäº§ç¯å¢ƒï¼ˆNginx è¿è¡Œä¸­ï¼‰"
else
    echo "å½“å‰æ˜¯å¼€å‘ç¯å¢ƒï¼ˆNginx æœªè¿è¡Œï¼‰"
fi
```

