# å¼€å‘ç¯å¢ƒå¯åŠ¨æŒ‡å—

## âœ… CORS é—®é¢˜å·²è§£å†³

é€šè¿‡é…ç½® Vite å¼€å‘æœåŠ¡å™¨ä»£ç†ï¼Œå‰ç«¯å¼€å‘æ—¶ä¸å†æœ‰è·¨åŸŸé—®é¢˜ã€‚

## ğŸ¯ å·¥ä½œåŸç†

### å¼€å‘ç¯å¢ƒ
```
æµè§ˆå™¨è®¿é—®: http://10.0.169.144:3003
                    â†“
        å‰ç«¯å¼€å‘æœåŠ¡å™¨ (Vite :3003)
                    â†“
        /api/*  â†’ ä»£ç†åˆ° http://localhost:8000
        /minio/* â†’ ä»£ç†åˆ° http://localhost:8999
```

### ç”Ÿäº§ç¯å¢ƒ
```
æµè§ˆå™¨è®¿é—®: http://39.183.168.206:30003
                    â†“
            Nginx (:3005 æ˜ å°„åˆ° 30003)
                    â†“
        /api/*  â†’ ä»£ç†åˆ° host:8000
        /minio/* â†’ ä»£ç†åˆ° MinIO å®¹å™¨
        /*      â†’ å‰ç«¯é™æ€æ–‡ä»¶ (dist/)
```

## ğŸš€ å¯åŠ¨æ­¥éª¤

### æ–¹å¼ 1ï¼šå¼€å‘ç¯å¢ƒï¼ˆæ¨èç”¨äºå¼€å‘ï¼‰

#### æ­¥éª¤ 1ï¼šå¯åŠ¨ Docker åŸºç¡€æœåŠ¡
```bash
cd /data/ht/workspace/Reader_QAQ/docker
docker-compose up -d reader_postgres reader_redis reader_minio
```

**ä¸è¦å¯åŠ¨ Nginx**ï¼Œå¼€å‘æ—¶ä¸éœ€è¦ã€‚

#### æ­¥éª¤ 2ï¼šå¯åŠ¨åç«¯
```bash
cd /data/ht/workspace/Reader_QAQ/src
python main.py
```

åç«¯ä¼šåœ¨ `http://localhost:8000` å¯åŠ¨ã€‚

#### æ­¥éª¤ 3ï¼šå¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
```bash
cd /data/ht/workspace/Reader_QAQ/web

# å¦‚æœåˆšä¿®æ”¹äº† vite.config.tsï¼Œéœ€è¦é‡å¯
npm run dev
```

å‰ç«¯ä¼šåœ¨ `http://10.0.169.144:3003` å¯åŠ¨ã€‚

#### æ­¥éª¤ 4ï¼šè®¿é—®
- æœ¬åœ°è®¿é—®ï¼š`http://localhost:3003`
- å†…ç½‘è®¿é—®ï¼š`http://10.0.169.144:3003`

**æ‰€æœ‰ API è¯·æ±‚ä¼šè¢« Vite è‡ªåŠ¨ä»£ç†åˆ°æœ¬åœ°åç«¯ï¼Œæ—  CORS é—®é¢˜ï¼** âœ…

---

### æ–¹å¼ 2ï¼šç”Ÿäº§ç¯å¢ƒï¼ˆç”¨äºéƒ¨ç½²ï¼‰

#### æ­¥éª¤ 1ï¼šæ„å»ºå‰ç«¯
```bash
cd /data/ht/workspace/Reader_QAQ/web
npm run build
```

#### æ­¥éª¤ 2ï¼šå¯åŠ¨æ‰€æœ‰ Docker æœåŠ¡ï¼ˆåŒ…æ‹¬ Nginxï¼‰
```bash
cd /data/ht/workspace/Reader_QAQ/docker
docker-compose up -d
```

#### æ­¥éª¤ 3ï¼šå¯åŠ¨åç«¯
```bash
cd /data/ht/workspace/Reader_QAQ/src
python main.py
```

#### æ­¥éª¤ 4ï¼šè®¿é—®
- å…¬ç½‘è®¿é—®ï¼š`http://39.183.168.206:30003`

---

## ğŸ“‹ é…ç½®è¯´æ˜

### Vite ä»£ç†é…ç½® (`vite.config.ts`)
```typescript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:8000',
      changeOrigin: true,
    },
    '/minio': {
      target: 'http://localhost:8999',
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/minio/, ''),
    },
  },
}
```

### API å®¢æˆ·ç«¯ (`web/lib/api.ts`)
```typescript
const API_BASE_URL = '/api';  // ä½¿ç”¨ç›¸å¯¹è·¯å¾„
```

### Docker Compose ç«¯å£
```yaml
reader_nginx:
  ports:
    - "3005:80"  # é¿å…ä¸å‰ç«¯å¼€å‘æœåŠ¡å™¨ (3003) å†²çª
```

æ˜ å°„å…³ç³»ï¼š
- å®¹å™¨å†…ï¼š80
- å®¿ä¸»æœºï¼š3005
- å…¬ç½‘ï¼š30003ï¼ˆé€šè¿‡ç«¯å£æ˜ å°„ 3005 â†’ 30003ï¼‰

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: å‰ç«¯è¯·æ±‚è¿˜æ˜¯è·¨åŸŸé”™è¯¯ï¼Ÿ

**åŸå› **ï¼šVite é…ç½®æœªç”Ÿæ•ˆ

**è§£å†³**ï¼š
```bash
# å®Œå…¨åœæ­¢å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼ˆCtrl+Cï¼‰
# ç„¶åé‡æ–°å¯åŠ¨
npm run dev
```

### Q2: API è¯·æ±‚ 404

**æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ**ï¼š
```bash
curl http://localhost:8000/api/health
# åº”è¯¥è¿”å›: {"status":"ok"}
```

**æ£€æŸ¥ Vite ä»£ç†é…ç½®**ï¼š
æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Networkï¼Œçœ‹è¯·æ±‚æ˜¯å¦æ­£ç¡®ä»£ç†ã€‚

### Q3: MinIO æ–‡ä»¶æ— æ³•åŠ è½½

**å¼€å‘ç¯å¢ƒ**ï¼šç¡®ä¿ MinIO åœ¨è¿è¡Œ
```bash
docker ps | grep reader_minio
curl http://localhost:8999/minio/health/live
```

**ç”Ÿäº§ç¯å¢ƒ**ï¼šç¡®ä¿ Nginx å®¹å™¨åœ¨è¿è¡Œ
```bash
docker ps | grep reader_nginx
```

### Q4: å¦‚ä½•åˆ‡æ¢å¼€å‘/ç”Ÿäº§ç¯å¢ƒï¼Ÿ

**å¼€å‘ç¯å¢ƒ**ï¼š
```bash
# åªå¯åŠ¨åŸºç¡€æœåŠ¡ï¼Œä¸å¯åŠ¨ Nginx
docker-compose up -d reader_postgres reader_redis reader_minio

# å¯åŠ¨åç«¯
cd src && python main.py

# å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
cd web && npm run dev
```

**ç”Ÿäº§ç¯å¢ƒ**ï¼š
```bash
# æ„å»ºå‰ç«¯
cd web && npm run build

# å¯åŠ¨æ‰€æœ‰ Docker æœåŠ¡
cd docker && docker-compose up -d

# å¯åŠ¨åç«¯
cd src && python main.py
```

---

## ğŸ“Š ç«¯å£å ç”¨æƒ…å†µ

| æœåŠ¡ | å¼€å‘ç¯å¢ƒç«¯å£ | ç”Ÿäº§ç¯å¢ƒç«¯å£ | å…¬ç½‘ç«¯å£ | è¯´æ˜ |
|------|------------|------------|---------|------|
| å‰ç«¯å¼€å‘ | 3003 | - | - | npm run dev |
| åç«¯ | 8000 | 8000 | - | python main.py |
| PostgreSQL | 5433 | 5433 | - | Docker |
| Redis | 6380 | 6380 | - | Docker |
| MinIO API | 8999 | 8999 | - | Docker |
| MinIO Console | 9002 | 9002 | - | Docker |
| Nginx | - | 3005 | 30003 | Dockerï¼ˆç”Ÿäº§ï¼‰ |

---

## âœ… éªŒè¯æ¸…å•

### å¼€å‘ç¯å¢ƒéªŒè¯
- [ ] `docker ps` æ˜¾ç¤º postgresã€redisã€minio è¿è¡Œä¸­
- [ ] `curl http://localhost:8000/api/health` è¿”å› OK
- [ ] è®¿é—® `http://localhost:3003` èƒ½çœ‹åˆ°ç™»å½•é¡µ
- [ ] èƒ½å¤ŸæˆåŠŸç™»å½•
- [ ] æµè§ˆå™¨å¼€å‘è€…å·¥å…· Network æ—  CORS é”™è¯¯

### ç”Ÿäº§ç¯å¢ƒéªŒè¯
- [ ] `docker ps` æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬ nginxï¼‰è¿è¡Œä¸­
- [ ] `ls web/dist/index.html` æ–‡ä»¶å­˜åœ¨
- [ ] è®¿é—® `http://39.183.168.206:30003` èƒ½çœ‹åˆ°ç™»å½•é¡µ
- [ ] èƒ½å¤ŸæˆåŠŸç™»å½•
- [ ] èƒ½å¤Ÿä¸Šä¼ æ–‡ä»¶

---

## ğŸ¯ æ¨èå·¥ä½œæµ

æ—¥å¸¸å¼€å‘ï¼š
1. å¯åŠ¨åŸºç¡€ Docker æœåŠ¡ï¼ˆåªå¯åŠ¨ä¸€æ¬¡ï¼‰
2. å¯åŠ¨åç«¯ï¼ˆæ¯æ¬¡ä¿®æ”¹åç«¯ä»£ç éœ€é‡å¯ï¼‰
3. å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼ˆè‡ªåŠ¨çƒ­æ›´æ–°ï¼‰

éƒ¨ç½²åˆ°ç”Ÿäº§ï¼š
1. æ„å»ºå‰ç«¯
2. å¯åŠ¨æ‰€æœ‰ Docker æœåŠ¡
3. å¯åŠ¨åç«¯

---

## ğŸ”§ å¿«æ·å‘½ä»¤

åˆ›å»ºåˆ«åæ–¹ä¾¿ä½¿ç”¨ï¼š

```bash
# æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.zshrc
alias reader-dev-start='cd /data/ht/workspace/Reader_QAQ && docker-compose -f docker/docker-compose.yml up -d reader_postgres reader_redis reader_minio'
alias reader-dev-stop='cd /data/ht/workspace/Reader_QAQ/docker && docker-compose stop'
alias reader-backend='cd /data/ht/workspace/Reader_QAQ/src && python main.py'
alias reader-frontend='cd /data/ht/workspace/Reader_QAQ/web && npm run dev'

# ä½¿ç”¨
reader-dev-start     # å¯åŠ¨åŸºç¡€æœåŠ¡
reader-backend      # å¯åŠ¨åç«¯
reader-frontend     # å¯åŠ¨å‰ç«¯
```

---

å®Œæˆï¼ç°åœ¨æ‚¨å¯ä»¥æ„‰å¿«åœ°å¼€å‘äº† ğŸ‰


